<script>
  const video = document.getElementById("camera");

  // Load models correctly
  Promise.all([
    faceapi.nets.tinyFaceDetector.loadFromUri("models/"),
    faceapi.nets.faceExpressionNet.loadFromUri("models/")
  ]).then(startCamera);

  function startCamera() {
    document.getElementById("status").innerText = "Point your face at the camera!";
    navigator.mediaDevices.getUserMedia({ video: true }).then(stream => {
      video.srcObject = stream;
    });
  }

  video.addEventListener("play", () => {
    const canvas = document.getElementById("overlay");
    const size = { width: video.width, height: video.height };
    faceapi.matchDimensions(canvas, size);

    setInterval(async () => {
      const detections = await faceapi
        .detectAllFaces(video, new faceapi.TinyFaceDetectorOptions())
        .withFaceExpressions();

      const resized = faceapi.resizeResults(detections, size);

      canvas.getContext("2d").clearRect(0, 0, canvas.width, canvas.height);
      faceapi.draw.drawDetections(canvas, resized);
      faceapi.draw.drawFaceExpressions(canvas, resized);
    }, 200);
  });
</script>
